---
import '../styles/global.css';
import Navbar from '../components/ui/Navbar.astro';
import Footer from '../components/ui/Footer.astro';
import CalendlyButton from '../components/ui/CalendlyButton';

interface Props {
  title: string;
  description?: string;
  image?: string;
}

const { title, description = "DevOps & Cloud Technology Blog by Kunal Das", image } = Astro.props;
const canonicalURL = new URL(Astro.url.pathname, Astro.site);
---

<!doctype html>
<html lang="en" class="scroll-smooth dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/png" href="/kd_favicon.png" />
    <link rel="apple-touch-icon" href="/kd_favicon.png" />
    <meta name="generator" content={Astro.generator} />

    <!-- SEO -->
    <title>{title} | Kunal Das</title>
    <meta name="description" content={description} />
    <link rel="canonical" href={canonicalURL} />

    <!-- Open Graph -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content={canonicalURL} />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    {image && <meta property="og:image" content={image} />}

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@kunald_official" />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />
    {image && <meta name="twitter:image" content={image} />}

    <!-- Leaflet CSS for maps -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />

  </head>
  <body class="min-h-screen bg-slate-900 text-slate-100">
    <Navbar />
    <main>
      <slot />
    </main>
    <Footer />
    <CalendlyButton client:load />

    <!-- Easter Egg: Terminal Mode -->
    <div id="terminal-overlay" class="hidden">
      <div class="terminal-prompt">
        <span class="blink">_</span> TERMINAL MODE ACTIVATED
        <br><span class="text-sm opacity-70">Type "exit" or press ESC to return</span>
      </div>
    </div>

    <!-- Easter Egg: Glitch Effect -->

    <style>
      /* Terminal Mode Styles */
      .terminal-mode {
        background: #0a0a0a !important;
        font-family: 'Courier New', monospace !important;
      }

      .terminal-mode * {
        font-family: 'Courier New', monospace !important;
        color: #00ff00 !important;
        border-color: #00ff00 !important;
        text-shadow: 0 0 5px #00ff00;
      }

      .terminal-mode img {
        filter: grayscale(100%) brightness(0.8) sepia(100%) hue-rotate(70deg) saturate(500%);
      }

      .terminal-mode a:hover {
        color: #00ff00 !important;
        text-shadow: 0 0 10px #00ff00, 0 0 20px #00ff00;
      }

      /* Scanlines effect */
      .terminal-mode::before {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: repeating-linear-gradient(
          0deg,
          rgba(0, 0, 0, 0.15),
          rgba(0, 0, 0, 0.15) 1px,
          transparent 1px,
          transparent 2px
        );
        pointer-events: none;
        z-index: 9998;
      }

      /* CRT flicker */
      .terminal-mode::after {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 255, 0, 0.03);
        pointer-events: none;
        z-index: 9997;
        animation: flicker 0.15s infinite;
      }

      @keyframes flicker {
        0% { opacity: 0.27; }
        5% { opacity: 0.34; }
        10% { opacity: 0.27; }
        15% { opacity: 0.34; }
        20% { opacity: 0.27; }
        25% { opacity: 0.34; }
        30% { opacity: 0.27; }
        35% { opacity: 0.34; }
        40% { opacity: 0.27; }
        45% { opacity: 0.34; }
        50% { opacity: 0.27; }
        55% { opacity: 0.34; }
        60% { opacity: 0.27; }
        65% { opacity: 0.34; }
        70% { opacity: 0.27; }
        75% { opacity: 0.34; }
        80% { opacity: 0.27; }
        85% { opacity: 0.34; }
        90% { opacity: 0.27; }
        95% { opacity: 0.34; }
        100% { opacity: 0.27; }
      }

      /* Terminal overlay prompt */
      #terminal-overlay {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 10000;
        background: #0a0a0a;
        border: 2px solid #00ff00;
        padding: 15px 20px;
        font-family: 'Courier New', monospace;
        color: #00ff00;
        text-shadow: 0 0 5px #00ff00;
        box-shadow: 0 0 20px rgba(0, 255, 0, 0.3);
      }

      #terminal-overlay .blink {
        animation: blink-cursor 1s step-end infinite;
      }

      @keyframes blink-cursor {
        50% { opacity: 0; }
      }

      #terminal-overlay.hidden {
        display: none;
      }

      /* Glitch Effect */
      .glitch-active {
        animation: glitch 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94) both;
      }

      @keyframes glitch {
        0% {
          transform: translate(0);
          filter: hue-rotate(0deg);
        }
        10% {
          transform: translate(-5px, 2px);
          filter: hue-rotate(90deg);
        }
        20% {
          transform: translate(5px, -2px);
          filter: hue-rotate(180deg);
        }
        30% {
          transform: translate(-3px, -3px) skewX(2deg);
          filter: hue-rotate(270deg);
        }
        40% {
          transform: translate(3px, 3px) skewX(-2deg);
          filter: hue-rotate(0deg) saturate(2);
        }
        50% {
          transform: translate(-2px, 1px);
          filter: hue-rotate(45deg) brightness(1.2);
        }
        60% {
          transform: translate(2px, -1px);
          filter: hue-rotate(135deg);
        }
        70% {
          transform: translate(-1px, 2px) skewY(1deg);
          filter: hue-rotate(225deg) contrast(1.2);
        }
        80% {
          transform: translate(1px, -2px);
          filter: hue-rotate(315deg);
        }
        90% {
          transform: translate(-2px, 0);
          filter: hue-rotate(0deg);
        }
        100% {
          transform: translate(0);
          filter: hue-rotate(0deg);
        }
      }

      .glitch-active::before {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: repeating-linear-gradient(
          0deg,
          transparent,
          transparent 2px,
          rgba(0, 255, 255, 0.03) 2px,
          rgba(0, 255, 255, 0.03) 4px
        );
        pointer-events: none;
        z-index: 10000;
        animation: scanlines 0.1s linear infinite;
      }

      @keyframes scanlines {
        0% { transform: translateY(0); }
        100% { transform: translateY(4px); }
      }

      .glitch-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 10001;
        mix-blend-mode: overlay;
      }

      .glitch-text {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-family: 'Courier New', monospace;
        font-size: 24px;
        color: #0ff;
        text-shadow:
          2px 0 #f0f,
          -2px 0 #0f0,
          0 0 10px #0ff;
        z-index: 10002;
        animation: glitchText 0.3s ease-out forwards;
        white-space: nowrap;
      }

      @keyframes glitchText {
        0% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
        20% { opacity: 1; transform: translate(-48%, -52%) scale(1.1); }
        40% { transform: translate(-52%, -48%) scale(1); }
        60% { transform: translate(-50%, -50%) scale(1.05); }
        80% { opacity: 1; }
        100% { opacity: 0; transform: translate(-50%, -50%) scale(1); }
      }
    </style>

    <script>
      // Easter Eggs
      const secrets = {
        devops: 'terminal',
        kubectl: 'podrain',
        exit: 'exit'
      };
      let typedKeys = '';
      let glitchActive = false;

      document.addEventListener('keydown', (e) => {
        // ESC to exit terminal mode
        if (e.key === 'Escape' && document.body.classList.contains('terminal-mode')) {
          deactivateTerminalMode();
          return;
        }

        // Only track letter keys
        if (e.key.length === 1 && e.key.match(/[a-z]/i)) {
          typedKeys += e.key.toLowerCase();

          // Keep only last N characters needed
          const maxLen = 10;
          if (typedKeys.length > maxLen) {
            typedKeys = typedKeys.slice(-maxLen);
          }

          // Check for devops -> terminal mode
          if (typedKeys.includes('devops') && !document.body.classList.contains('terminal-mode')) {
            activateTerminalMode();
            typedKeys = '';
          }

          // Check for kubectl -> glitch effect
          if (typedKeys.includes('kubectl') && !glitchActive) {
            triggerGlitch();
            typedKeys = '';
          }

          // Check for exit word
          if (typedKeys.includes('exit') && document.body.classList.contains('terminal-mode')) {
            deactivateTerminalMode();
            typedKeys = '';
          }
        }
      });

      function activateTerminalMode() {
        document.body.classList.add('terminal-mode');
        document.getElementById('terminal-overlay')?.classList.remove('hidden');
        console.log('%c> TERMINAL MODE ACTIVATED', 'color: #00ff00; font-family: monospace; font-size: 16px;');
        console.log('%c> Type "exit" or press ESC to return to normal mode', 'color: #00ff00; font-family: monospace;');
      }

      function deactivateTerminalMode() {
        document.body.classList.remove('terminal-mode');
        document.getElementById('terminal-overlay')?.classList.add('hidden');
        console.log('%c> Terminal mode deactivated', 'color: #888; font-family: monospace;');
      }

      function triggerGlitch() {
        glitchActive = true;

        console.log('%c> kubectl: system glitch detected', 'color: #0ff; font-family: monospace; font-size: 16px; text-shadow: 2px 0 #f0f;');

        // Add glitch class to body
        document.body.classList.add('glitch-active');

        // Create glitch text overlay
        const glitchText = document.createElement('div');
        glitchText.className = 'glitch-text';
        glitchText.textContent = '$ kubectl get pods';
        document.body.appendChild(glitchText);

        // Remove effects after animation
        setTimeout(() => {
          document.body.classList.remove('glitch-active');
          glitchText.remove();
          glitchActive = false;
        }, 800);
      }
    </script>
  </body>
</html>
