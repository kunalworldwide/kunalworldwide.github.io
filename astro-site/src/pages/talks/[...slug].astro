---
import { getCollection, render } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';

export async function getStaticPaths() {
  const talks = await getCollection('talks');
  return talks.map((talk) => ({
    params: { slug: talk.id },
    props: { talk },
  }));
}

const { talk } = Astro.props;
const { Content } = await render(talk);

const formattedDate = talk.data.date.toLocaleDateString('en-US', {
  year: 'numeric',
  month: 'long',
  day: 'numeric',
});
---

<BaseLayout title={talk.data.title} description={talk.data.description}>
  <article class="pt-32 pb-16 px-4 sm:px-6 lg:px-8">
    <div class="max-w-4xl mx-auto">
      <!-- Header -->
      <header class="mb-12">
        <div class="flex flex-wrap gap-2 mb-4">
          {talk.data.categories.map((category: string) => (
            <span class="px-3 py-1 text-sm font-medium bg-purple-900/30 text-purple-400 rounded-full">
              {category}
            </span>
          ))}
        </div>

        <h1 class="text-4xl sm:text-5xl font-extrabold tracking-tight mb-4 text-white">
          {talk.data.title}
        </h1>

        <p class="text-xl text-slate-400 mb-6">
          {talk.data.description}
        </p>

        <div class="flex flex-wrap items-center gap-4 text-slate-400 mb-6">
          <time datetime={talk.data.date.toISOString()}>
            {formattedDate}
          </time>
          {talk.data.venue && (
            <>
              <span>‚Ä¢</span>
              <span>{talk.data.venue}</span>
            </>
          )}
          {talk.data.location && (
            <>
              <span>‚Ä¢</span>
              <span>üìç {talk.data.location}</span>
            </>
          )}
        </div>

        <!-- Action Buttons -->
        <div class="flex flex-wrap gap-4">
          {talk.data.slides && (
            <a
              href={talk.data.slides}
              target="_blank"
              rel="noopener noreferrer"
              class="inline-flex items-center gap-2 px-6 py-3 rounded-xl bg-blue-600 text-white font-medium hover:bg-blue-700 transition-colors"
            >
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
              </svg>
              View Slides
            </a>
          )}
          {talk.data.video && (
            <a
              href={talk.data.video}
              target="_blank"
              rel="noopener noreferrer"
              class="inline-flex items-center gap-2 px-6 py-3 rounded-xl bg-red-600 text-white font-medium hover:bg-red-700 transition-colors"
            >
              <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                <path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/>
              </svg>
              Watch Video
            </a>
          )}
          {talk.data.event && (
            <a
              href={talk.data.event}
              target="_blank"
              rel="noopener noreferrer"
              class="inline-flex items-center gap-2 px-6 py-3 rounded-xl border border-slate-600 text-slate-300 font-medium hover:border-blue-500 transition-colors"
            >
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
              </svg>
              Event Page
            </a>
          )}
        </div>
      </header>

      <!-- Content -->
      <div class="prose prose-lg prose-invert prose-purple max-w-none
        prose-headings:font-bold prose-headings:tracking-tight
        prose-a:text-purple-400
        prose-code:text-purple-400
        prose-pre:bg-slate-900 prose-pre:border prose-pre:border-slate-700">
        <Content />
      </div>

      <!-- Back Link -->
      <div class="mt-16 pt-8 border-t border-slate-700">
        <a
          href="/talks"
          class="inline-flex items-center gap-2 text-purple-400 hover:underline font-medium"
        >
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
          </svg>
          Back to all talks
        </a>
      </div>
    </div>
  </article>
</BaseLayout>
